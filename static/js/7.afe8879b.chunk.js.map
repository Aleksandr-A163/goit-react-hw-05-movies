{"version":3,"sources":["components/SearchMovie/SearchMovie.js","views/SearchMovie.js","Service/Service-api.js","Service/infinite-scroll-service.js","components/SearchMovie/SearchMovie.module.css"],"names":["SearchMovie","history","useHistory","location","useLocation","url","useRouteMatch","useState","inputQuery","setInputQuery","searchMovieArr","setSearchMovieArr","totalMovie","setTotalMovie","page","setPage","status","setStatus","inputRef","useRef","useEffect","newQuery","search","slice","length","a","api","newRequest","data","results","total_results","console","log","fetchData","nextFetch","prevState","infiniteScroll","className","s","Searchbar","SearchTitle","SearchForm","onSubmit","e","preventDefault","trim","push","current","placeholder","toast","warn","autoClose","theme","icon","type","SearchFormButton","SearchFormInput","name","ref","value","onChange","currentTarget","pattern","title","Loader","id","SearchList","map","item","backdrop_path","release_date","to","pathname","state","from","SearchListItem","src","alt","SearchListItemImage","SearchedMovieTitle","SearchFilms","BASE_URL","API_KEY","getTrendingMovies","axios","get","getMovie","searchQuery","getSingleFilm","filmId","getCast","getReviews","arr","timeOut","threshold","callFoo","lastId","setTimeout","lastTarget","document","getElementById","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","unobserve","target","observe","module","exports"],"mappings":"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","file":"static/js/7.afe8879b.chunk.js","sourcesContent":["import { useState, useRef, useEffect } from 'react';\r\nimport { Link, useRouteMatch } from \"react-router-dom\";\r\nimport { useHistory, useLocation} from 'react-router-dom';\r\nimport { ImSearch } from 'react-icons/im';\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport s from './SearchMovie.module.css';\r\nimport { toast } from 'react-toastify';\r\nimport PropTypes from 'prop-types';\r\nimport * as api from '../../Service/Service-api';\r\nimport infiniteScroll from '../../Service/infinite-scroll-service';\r\nimport Loader from '../Loader/Loader';\r\n// import NoImage from '../../images/NoImage.PNG'\r\n\r\nconst BASE_IMG_URL = 'https://image.tmdb.org/t/p/w300';\r\n\r\nfunction SearchMovie() {\r\n    const history = useHistory();\r\n    const location = useLocation();\r\n    const { url } = useRouteMatch();\r\n    const [inputQuery, setInputQuery] = useState('');\r\n    const [searchMovieArr, setSearchMovieArr] = useState([]);\r\n    const [totalMovie, setTotalMovie] = useState(0);\r\n    const [page, setPage] = useState(1);\r\n    const [status, setStatus] = useState('');\r\n\r\n    const inputRef = useRef();\r\n\r\n    useEffect(() => {\r\n\r\n        const newQuery = location.search.slice(7, location.search.length)\r\n\r\n        async function fetchData() {\r\n            if (!location.search) return;\r\n            setStatus('pending');\r\n            let newRequest;\r\n            try {\r\n                newRequest = await api.getMovie(newQuery, 1);\r\n                // newRequest = await movieApiService.fetchMovie(newQuery, 1);\r\n                \r\n                setSearchMovieArr([...newRequest.data.results]);\r\n                setTotalMovie(newRequest.data.total_results);\r\n                setStatus(() => {\r\n                    return (\r\n                        newRequest.data.results === 0 ?\r\n                            'rejected' :\r\n                            'resolved'\r\n                    )\r\n                });\r\n            }\r\n            catch (error) {\r\n                console.log('Error: request failed');\r\n                return setStatus('failed')\r\n            };\r\n        };\r\n\r\n        fetchData();\r\n    }, [location, history]);\r\n\r\n    const handleInputChange = e => setInputQuery(e.currentTarget.value);\r\n\r\n    const handleSubmit = e => {\r\n        e.preventDefault();\r\n        if (inputQuery.trim() === '') {\r\n            toast.warn('Введи что-то!', {\r\n                autoClose: 2000,\r\n                theme: \"colored\",\r\n                icon: false,\r\n                }\r\n            );\r\n            return;\r\n        };\r\n        // setSearchQuery(inputQuery);\r\n        history.push({\r\n                    search: `query=${inputQuery}`,\r\n                })\r\n        inputRef.current.placeholder = inputQuery;\r\n        setInputQuery('');\r\n    };\r\n\r\n           // подгрузку последующих страниц, кроме первой\r\n\r\n    useEffect(() => {\r\n        if (page === 1) return;\r\n        const newQuery = location.search.slice(7, location.search.length)\r\n        async function nextFetch() {\r\n            let newRequest;\r\n            try {\r\n                newRequest = await api.getMovie(newQuery, page);\r\n                // newRequest = await movieApiService.fetchMovie(newQuery, page);\r\n                if (newRequest.data.results.length === 0) return;\r\n                setSearchMovieArr(prevState => [...prevState, ...newRequest.data.results]);\r\n                setTotalMovie(newRequest.data.total_results);\r\n            }\r\n            catch (error) {\r\n                console.log('Error: request failed');\r\n                return setStatus('failed')\r\n            };       \r\n        };\r\n        nextFetch();\r\n    }, [page, location]);\r\n\r\n    // бесконечный скрол\r\n\r\n    useEffect(() => {\r\n        infiniteScroll(searchMovieArr, 600, 0.2, () => setPage(prevState => prevState + 1));\r\n    }, [searchMovieArr]);\r\n\r\n    return (\r\n    <>\r\n        <div className={s.Searchbar} >\r\n            <span className={s.SearchTitle}>Search:</span>\r\n            <form className={s.SearchForm} onSubmit={handleSubmit}>\r\n                <button type=\"submit\" className={s.SearchFormButton}>\r\n                    <ImSearch />\r\n                </button>\r\n                <label >\r\n                    <input\r\n                        className={s.SearchFormInput}\r\n                        type=\"text\"\r\n                        name=\"searchInput\"\r\n                        ref={inputRef}\r\n                        placeholder=\"Type movie name\"\r\n                        value={inputQuery}\r\n                        onChange={handleInputChange}\r\n                        pattern=\"^[0-9a-zA-Zа-яА-Я]+(([' -][a-zA-Zа-яА-Я ])?[a-zA-Zа-яА-Я]*)*$\"\r\n                        title=\"Поисковое слово может состоять только из букв, апострофа, тире, цифр и пробелов.\"\r\n                    // required\r\n                    />\r\n                </label>\r\n            </form>\r\n        </div>\r\n        \r\n        {(status === 'pending') && <Loader />}\r\n\r\n        {(status === 'rejected') && <h2 className=\"galleryTitle\">По запросу ничего не найдено</h2>}\r\n        \r\n        {(status === 'failed') && <h2 className=\"galleryTitle\">Error: request failed. Нет соединения с интернетом или сервером</h2>}\r\n        \r\n        {(status === 'resolved' && location.search) && (\r\n            <>\r\n                <ul id=\"search-gallery\" className={s.SearchList}>\r\n                    {searchMovieArr.map(item => {\r\n                        const { id, backdrop_path, title, release_date } = item;\r\n                        return (\r\n                            <li key={id}  id={id}>\r\n                                <Link\r\n                                    to={{\r\n                                        pathname: `${url}/${id}`,\r\n                                        state: { from: location },\r\n                                    }}   \r\n                                    className={s.SearchListItem} >\r\n                                {backdrop_path && <img src={`${BASE_IMG_URL}${backdrop_path}`} alt={title} className={s.SearchListItemImage} />}\r\n                                {/* {!backdrop_path && <img src={NoImage} alt=\"NoImage\" />} */}\r\n                                <span className={s.SearchedMovieTitle}>{title}</span>\r\n                                <span className={s.SearchedMovieTitle}>relised: {release_date}</span>\r\n                                </Link>\r\n                            </li>\r\n                        );\r\n                    })}\r\n                </ul>\r\n            </> \r\n            )}\r\n            \r\n        {((page * 20 >= totalMovie) && (status === 'resolved')) && <h2 className=\"galleryTitle\">Запрос успешно выполнен</h2>}\r\n\r\n        <ToastContainer/>\r\n    </>\r\n        \r\n    )\r\n};\r\n \r\nSearchMovie.propTypes = {\r\n    searchQuery: PropTypes.string,\r\n};\r\n\r\nexport default SearchMovie;","import  SearchMovie  from '../components/SearchMovie/SearchMovie';\r\n\r\nexport default function SearchFilms() {\r\n    return (\r\n        <>\r\n            <SearchMovie/>\r\n        </>\r\n    )\r\n};","import axios from \"axios\";\n\nconst BASE_URL = \"https://api.themoviedb.org/3/\";\nconst API_KEY = \"367b0facb69c6afab44aa6f928a1cec5\";\n\nexport const getTrendingMovies = (page) =>\n  axios.get(`${BASE_URL}trending/movie/day?api_key=${API_KEY}&page=${page}`);\n\nexport const getMovie = (searchQuery, page) =>\n  axios.get(`${BASE_URL}search/movie?api_key=${API_KEY}&page=${page}&query=${searchQuery}&include_adult=false`);\n\nexport const getSingleFilm = (filmId) =>\n  axios.get(`${BASE_URL}movie/${filmId}?api_key=${API_KEY}`);\n\nexport const getCast = (filmId) =>\n  axios.get(`${BASE_URL}movie/${filmId}/credits?api_key=${API_KEY}`);\n\nexport const getReviews = (filmId) =>\n  axios.get(`${BASE_URL}movie/${filmId}/reviews?api_key=${API_KEY}&page=1`);\n","function infiniteScroll(arr, timeOut, threshold, callFoo) {\r\n    if (arr.length === 0) return;\r\n        let lastId = (arr[arr.length - 1].id);   //запоминаем id крайнего на даный момент элемента гллереи\r\n        setTimeout(() => { \r\n            const lastTarget = document.getElementById(lastId); //получаем этот элемент и делаем его целью наблюдения для IntersectionObserver\r\n            let observer = new IntersectionObserver((entries, observer) => {\r\n                entries.forEach((entry) => {\r\n                    if (entry.isIntersecting) {\r\n                        callFoo(); //запуск подгрузки следующих элементов\r\n                        observer.unobserve(entry.target);  //остановка наблюдателя видимой частью окна для объявленой цели\r\n                    };\r\n                });\r\n            }, {threshold: threshold}); //подгрузка следующих элементов сработает при появлении threshold% цели в области видимости окна\r\n\r\n            observer.observe(lastTarget);  //запуск наблюдателя за видимой частью окна \r\n        }, timeOut);\r\n}\r\n\r\nexport default infiniteScroll;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Searchbar\":\"SearchMovie_Searchbar__HT7QA\",\"SearchTitle\":\"SearchMovie_SearchTitle__275pU\",\"SearchForm\":\"SearchMovie_SearchForm__190dg\",\"SearchFormButton\":\"SearchMovie_SearchFormButton__2LZI1\",\"SearchFormInput\":\"SearchMovie_SearchFormInput__2aAkI\",\"SearchList\":\"SearchMovie_SearchList__1jfBZ\",\"SearchListItem\":\"SearchMovie_SearchListItem__2bc0L\",\"SearchListItemImage\":\"SearchMovie_SearchListItemImage__3B5Z4\",\"SearchedMovieTitle\":\"SearchMovie_SearchedMovieTitle__1jF3m\"};"],"sourceRoot":""}